<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Universal Gemini Chat</title>
</head>
<body>

    <h1>Chat with Gemini (Securely!)</h1>
    
    <input type="text" id="promptInput" placeholder="Ask Gemini anything..." style="width: 80%;">
    <button onclick="sendMessage()">Send</button>

    <p id="response" style="margin-top: 20px; border: 1px solid #ccc; padding: 10px; white-space: pre-wrap;">Response will appear here...</p>

    <script>
        // *** CORRECT VERCEL SECURE PROXY ENDPOINT ***
        const PROXY_URL = "https://gemini-api-proxy-xi-two.vercel.app/api/gemini"; 
        
        // CRITICAL FIX: Setting the supported model name
        const MODEL_NAME = "gemini-2.5-flash"; 

        async function sendMessage() {
            const promptInput = document.getElementById('promptInput');
            const prompt = promptInput.value;
            const responseElement = document.getElementById('response');
            responseElement.textContent = "Waiting for response from secure proxy...";

            if (!prompt) {
                responseElement.textContent = "Please enter a message.";
                return;
            }

            const requestBody = {
                contents: [
                    { parts: [{ text: prompt }] }
                ],
                model: MODEL_NAME 
            };

            try {
                const response = await fetch(PROXY_URL, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(requestBody)
                });

                const data = await response.json();

                if (response.ok) {
                    if (data.candidates && data.candidates[0].content && data.candidates[0].content.parts) {
                        const geminiText = data.candidates[0].content.parts[0].text;
                        responseElement.textContent = geminiText;
                        promptInput.value = ''; // Clear the input field after sending
                    } else {
                        responseElement.textContent = "Error: Could not get a valid response from the AI.";
                    }
                } else {
                    responseElement.textContent = `Error from Proxy Server: ${data.error.message || data.error || response.statusText}`;
                }


            } catch (error) {
                console.error('Fetch error:', error);
                responseElement.textContent = `Network Error: Could not connect to the proxy server.`;
            }
        }
        
        // >>>>>> NEW JAVASCRIPT FIX FOR ENTER KEY <<<<<<
        document.addEventListener('DOMContentLoaded', () => {
            const inputField = document.getElementById('promptInput');

            // Attach a listener to the input field itself
            inputField.addEventListener('keypress', function (e) {
                // Check if the key pressed is the Enter key (key code 13)
                if (e.key === 'Enter') {
                    e.preventDefault(); // Stop the default browser action (like reloading the page)
                    sendMessage();      // Call your function
                }
            });
        });
        // >>>>>> END NEW JAVASCRIPT FIX <<<<<<
    </script>
</body>
</html>
